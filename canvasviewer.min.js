!function(){WPViewer=function(){function t(){function t(){this.locale=new l,this.locale.init(),this.simpleViewer=new i,this.simpleViewer.init()}function n(){t()}var r=!0;this.startFile,this.simpleViewer,this.viewers=[],this.activeViewer,this.init=function(){e().init(n)},this.getDomPath=function(t){for(var e=[];null!=t.parentNode;){for(var n=0,i=0,r=0;r<t.parentNode.childNodes.length;r++){var o=t.parentNode.childNodes[r];o.nodeName==t.nodeName&&(o===t&&(i=n),n++)}t.hasAttribute("id")&&""!=t.id?e.unshift(t.nodeName.toLowerCase()+t.id):n>1?e.unshift(t.nodeName.toLowerCase()+i):e.unshift(t.nodeName.toLowerCase()),t=t.parentNode}return e.slice(1)},this.trace=function(t){r&&console.log("WPAPP - "+t)}}function e(){function t(){c(this),this.templateManager=new r,this.contentManager=new s,this.contentManager.init(p,this.globalVars),this.templateManager.init(v,u)}function e(){p&&v&&t()}function n(){var t=b.substring(0,b.lastIndexOf("/")+1);rootVarValue=globalVars.root,".."==rootVarValue&&(t=t.substring(0,t.substring(0,t.length-2).lastIndexOf("/")+1)),globalVars.root=t}function i(t){g=(new window.DOMParser).parseFromString(t,"text/xml").firstChild,h(g.querySelector("variables"),this),n(),d=g.querySelector("contents").getAttribute("url"),a.load(this.resolveGlobalVars(d),o,this),f=g.querySelector("template").getAttribute("url"),a.load(this.resolveGlobalVars(f),l,this)}function o(t){p=(new window.DOMParser).parseFromString(t,"text/xml").firstChild,h(p.querySelector("variables"),this),e()}function l(t){v=(new window.DOMParser).parseFromString(t,"text/xml").firstChild,h(v.querySelector("variables"),this),e()}function u(){this.ready=!0,m()}function c(t){for(var e in t.globalVars)t.globalVars[e]=a.resolveVars(t.globalVars[e],t.globalVars,"$")}function h(t,e){for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];1==i.nodeType&&(e.globalVars[i.nodeName]=a.resolveVars(i.getAttribute("value"),e.globalVars,"$"))}}if(arguments.callee._singletonInstance)return arguments.callee._singletonInstance;arguments.callee._singletonInstance=this,this.contentManager,this.templateManager;var g,d,f,p,v,m,b="publication/contents/pubinfo.xml";return this.globalVars={},this.ready=!1,this.init=function(t){a.load(b,i,this),m=t},this.resolveGlobalVars=function(t){return a.resolveVars(t,this.globalVars,"$")},this}function n(t){function n(t){i()||o()}function i(){f=[],p=[];for(var t=wpApp.activeViewer.currentPage,e=t-w>0?t-w:0,n=N-1>=t+x?t+x:N-1,i=t-A>0?t-A:0,r=N-1>=t+y?t+y:N-1,o=0;N>=o;++o)o>=e&&n>=o&&null==F[o]&&f.push(o),null!=F[o]&&(i>o||o>r)&&p.push(o);return!(f.length>0||p.length>0)}function r(t,e,n,i,r){null==r&&(r=b);var o=function(t){e.apply(r,[t,i])};a.load(t,o,this)}function o(){for(var t=0;t<f.length;++t){var n=f[t];if(null==P[n]){P[n]=!0;var i=e().contentManager.getFilePath(m,n);"jpg"==S?b.createImageLoader(i,s,l,n,this):"xml"==S&&r(i,s,l,n,this),V++}}u()}function s(t,e){F[e]=t,P[e]=null,d(e),V--}function l(t,e){if(P[e]=null,null!=L[e])for(var n=L[e];n.length>0;){var i=n[0];i.onItemMissing(C[e],e),g(i,e)}}function u(){for(var t=0;t<p.length;++t){var e=p[t];F[e]=null}}function c(t,e){h(t),void 0==L[e]&&(L[e]=[]),-1==L[e].indexOf(t)&&L[e].push(t)}function h(t){var e;for(var n in L){var i=L[n];e=i.indexOf(t),-1!=e&&i.splice(e,1)}}function g(t,e){var n=L[e];index=n.indexOf(t),-1!=index&&n.splice(index,1)}function d(t){if(null!=C[t]&&null!=L[t])for(var e=L[t];e.length>0;){var n=e[0];n[b.labelFunction](C[t],t),g(n,t)}}var f,p,v,m=t,b=this,w=2,x=2,A=3,y=3,P=[],V=0,L=[];this.labelFunction="onPageLoaded";var S=e().contentManager.getProperty(m,"extensions"),N=e().contentManager.pagesNum,F=[],C=F;this.onPageChange=function(){clearTimeout(v),v=setTimeout(n,60,this)},this.getPage=function(t,e){return 0>t||t>N?null:null==F[t]?(i(),-1==f.indexOf(t)&&f.push(t),o(),F[t]?F[t]:(c(e,t),null)):F[t]},this.createImageLoader=function(t,e,n,i,r){var o=new Image;null==r&&(r=b),o.onload=function(){e.apply(r,[this,i])},o.onerror=function(){n.apply(r,[this,i])},o.src=t},this.invalidate=function(t){F[t]=null,P[t]=null},this.clean=function(){var t=e().contentManager.pagesNum;p=[];for(var n=0;t>=n;++n)p.push(n);u()},this.destroy=function(){clearTimeout(v),P&&(P.length=0),f&&(f.length=0),p&&(p.length=0),F&&(F.length=0),L.length=0,L=null,C=null}}function i(){function t(){return{x:rt,y:ot,width:H-rt-nt,height:k-ot-it}}function r(){if(null!=G||null!=B){B=null!=G?G.naturalWidth:B,Y=null!=G?G.naturalHeight:Y;var e=a.getRestrictRect({x:0,y:0,width:B,height:Y},t());e.marginXNext=H-e.x,e.scale=e.width/ut,Z=e}}function o(){z=(new window.DOMParser).parseFromString(z,"text/xml"),z=z.querySelectorAll("lk"),u();for(var t=0;t<z.length;t++){var n=z[t],i=n.querySelector("content"),r={};if(r.x=parseFloat(i.getAttribute("x")),r.y=parseFloat(i.getAttribute("y")),r.width=parseFloat(i.getAttribute("width")),r.height=parseFloat(i.getAttribute("height")),r.contentFile=i.querySelector("file"),r.contentFile){r.contentFile=e().resolveGlobalVars(r.contentFile.getAttribute("url"));var o=function(t){c.apply(K,[t,n,r])};a.load(r.contentFile,o,this)}}}function s(){l();var t=J.getPage(K.currentPage,K);null!=t&&K.onLinkLoaded(t,K.currentPage)}function l(){for(var t=0;t<lt.length;t++){var e=lt[t];M.removeChild(e.element),e.animClass.destroy()}lt.length=0}function u(){M.setAttribute("style",Q+"transform: translate("+(Z.x+tt)+"px, "+(Z.y+et)+"px) scale3d("+Z.scale+","+Z.scale+","+Z.scale+")")}function c(t,e,n){anim=(new window.DOMParser).parseFromString(t,"text/html"),style=anim.body.querySelector("style"),bodyChildren=anim.querySelectorAll("body > div"),script=anim.querySelector("script");var i=document.createElement("div");i.setAttribute("id","wpanim"),i=M.appendChild(i),i.setAttribute("style","position: absolute;transform: translate("+n.x+"px, "+n.y+"px)"),n.element=i,lt.push(n),i.appendChild(style);for(var r=0;r<bodyChildren.length;r++){var o=bodyChildren[r],s=o.querySelector("img"),a=s.getAttribute("src").replace("assets/",n.contentFile+"assets/");s.setAttribute("src",a),i.appendChild(o)}a=script.getAttribute("src").replace("assets/",n.contentFile+"assets/");var l=document.createElement("script");l.type="text/javascript",l.src=a,l=i.appendChild(l),l.onload=function(t){h(t,l,n)}}function h(t,e,n){n.animClass=WPAnimsClasses[wpApp.getDomPath(e).join("")]}function g(){if(null!=G){var t=Z.width/G.width,e=I?Q:"transition:none;";if(W&&st){var n=-1==R?Z.x+tt:Z.x+tt;G.setAttribute("style",e+"transform:translate("+n+"px,"+Z.y+"px) scale("+t+","+t+")"),I=!0,t=Z.width/W.width,n=1==R?Z.marginXNext+Z.x+tt:Z.x+tt-Z.marginXNext,e=q?Q:"transition:none;",W.setAttribute("style",e+"transform:translate("+n+"px,"+Z.y+"px) scale("+t+","+t+")"),q=!0}else console.log(I),console.log(Q),console.log(e),G.setAttribute("style",e+"transform:translate("+Z.x+"px,"+Z.y+"px) scale("+t+","+t+")"),I=!0,C&&V()}}function d(){null!=G&&(null==W?G.parentElement!=F&&(G=F.insertBefore(G,M),G.setAttribute("class","absolute notInteractive")):(G.parentElement!=F&&(G=F.insertBefore(G,M),G.setAttribute("class","absolute")),G.height=Z.height,W=F.insertBefore(W,M),W.setAttribute("class","absolute notInteractive")),console.log("drawPage"),g())}function f(t){return t>=0&&at>t}function p(){var t=K.currentPage;return++t>=at-1&&(t=at-1),t}function v(){var t=K.currentPage;return--t<0&&(t=0),t}function m(t){t.touches&&(t=t.touches[0]),st||(console.log(""),console.log("onMouseDown"),T=t.clientX,_=t.clientY,tt=0,et=0,F.addEventListener("touchmove",w),F.onmousemove=function(t){w(t)},F.addEventListener("touchend",b),F.onmouseup=function(t){b(t)},E=!0,window.requestAnimationFrame(x))}function b(t){console.log("onMouseUp"),F.onmousemove=null,F.removeEventListener("touchmove",w),F.onmouseup=null,F.removeEventListener("touchend",b),E=!1,Q="transition:none;",st&&y()}function w(t){t.touches&&(t=t.touches[0]),tt=t.clientX-T,D=!0}function x(t){D&&(null==O||t-O>=ct)&&(st||(0>tt?A(1):tt>0&&A(-1)),Q="transition: transform "+ht+"s linear;",O=t,u(),console.log("dragFrameAnim"),g(),D=!1),E&&window.requestAnimationFrame(x)}function A(t){return f(K.currentPage+t)?($&&(clearTimeout($),$=null),I=!1,R=t,st=!0,W=U.getPage(1==R?p():v(),K),q=!1,void(null!=W&&d())):(tt=0,F.onmousemove=null,console.log("startDrag"),void g())}function y(){console.log("stopTransition"),O=null,X=(-H+Z.x)*R,startXOffset=tt,tt=X,Q="transition: transform 0.25s ease-in;",D=!1,null!=G?(I=!0,G.addEventListener("transitionend",P,!1),C=!0,g(),u()):V()}function P(t){console.log("onPageTransitionEnd"),G.removeEventListener("transitionend",P),V()}function V(){console.log("endTransition"),C=!1,null!=G&&G.parentElement.removeChild(G),G=W,I=!1,W=null,1==R?K.currentPage=p():K.currentPage=v(),tt=0,st=!1,j=null,U.onPageChange(),J.onPageChange(),d(),$=setTimeout(L,500,K),s()}function L(t){var n=e().contentManager.getFilePath("Zoom",t.currentPage);U.createImageLoader(n,S,N,t.currentPage,t)}function S(t,e){e!=K.currentPage||st||(G.parentElement.removeChild(G),G=t,I=!1,console.log("onZoomPageLoaded"),d())}function N(t,e){wpApp.trace("onZoomPageError")}i.prototype.id="simpleViewer",i.prototype.currentPage=0;var F,C,M,T,D,E,q,I,O,_,G,H,k,R,W,X,j,$,z,B,Y,Z,U,J,K=this,Q="",tt=0,et=0,nt=10,it=10,rt=10,ot=10,st=!1,at=e().contentManager.pagesNum,lt=[],ut=parseFloat(e().contentManager.getProperty("swf","width")),ct=85,ht=.13;i.prototype.init=function(){F=document.createElement("div"),F=document.body.appendChild(F),F.onselectstart=function(t){return t.preventDefault(),!1},F.onmousedown=function(t){m(t)},F.addEventListener("touchstart",function(t){m(t)}),F.setAttribute("class","simpleViewer"),M=document.createElement("div"),M.setAttribute("class","absolute"),F.appendChild(M),wpApp.viewers.push[this],wpApp.activeViewer=this,U=new n("Low"),J=new n("links"),J.labelFunction="onLinkLoaded",H=window.innerWidth,k=window.innerHeight,r();var t=U.getPage(0,K);null!=t&&this.onPageLoaded(t,0),window.onresize=function(){K.onResize()}},i.prototype.onResize=function(){H=window.innerWidth,k=window.innerHeight,r(),d(),u()},i.prototype.onPageLoaded=function(t,e){G=t,I=!1,null==Z&&r(),console.log("onPageLoaded"),d(),J.getPage(K.currentPage,K),clearTimeout($),$=setTimeout(L,500,K)},i.prototype.onLinkLoaded=function(t,e){e==this.currentPage&&(z=t,o())}}function r(){function t(t,n,i){a++,s[n]=new o(t,n,e().resolveGlobalVars(i),e().templateManager.onAssetLoaded)}var n,i,r,s={},a=0,l=["main_lib","interface","css","css_flash","css_html5","description_css","font","shop_lib"],u=["interface","locale","config","locale_cart","tpl","tpl2"];this.init=function(e,o){n=e,r=o,i=n.querySelector("assets");for(var s=0;s<i.childNodes.length;s++){var a=i.childNodes[s];if(1==a.nodeType){var c=a.getAttribute("id");if(!(u&&-1==u.indexOf(c)||!u&&l&&-1!=l.indexOf(c))){var h=a.getAttribute("onstart");(void 0==h||"true"==h)&&t(a.getAttribute("type"),c,a.getAttribute("url"))}}}},this.onAssetLoaded=function(t,e){a--,0==a&&r&&r()},this.getAsset=function(t){return s[t]?s[t].content:(console.log("Asset not declared : "+t),null)}}function o(t,e,n,i){var r=i;this.content,o.prototype.onLoaded=function(t){this.content=t,r(this,this.content)},a.load(n,this.onLoaded,this)}function s(){var t,n="0000000000000000",i="num",r="%",o=r+i+r;this.paths={},this.prefixes={},this.suffixes={},this.paddings={},this.extensions={},this.fileNames={},this.width={},this.height={};var s="",l="",u=0,c=0;this.pagesNum,this.init=function(e,n){t=e.querySelector("contents"),l=t.getAttribute("prefix")?t.getAttribute("prefix"):"",s=t.getAttribute("sufix")?t.getAttribute("suffix"):"",u=t.getAttribute("padding")?parseInt(t.getAttribute("padding")):0,c=t.getAttribute("shift")?parseInt(t.getAttribute("shift")):0,this.pagesNum=t.getAttribute("pages_nr")?parseInt(t.getAttribute("pages_nr")):0;for(var i,r,o=0;o<t.childNodes.length;o++)r=t.childNodes[o],1==r.nodeType&&(i=r.getAttribute("id"),this.paths[i]=a.resolveVars(r.getAttribute("path",n,"$")),this.extensions[i]=r.getAttribute("type")?r.getAttribute("type"):"",this.prefixes[i]=r.getAttribute("prefix")?r.getAttribute("prefix"):l,this.suffixes[i]=r.getAttribute("suffix")?r.getAttribute("suffix"):s,this.paddings[i]=r.getAttribute("padding")?parseInt(r.getAttribute("padding")):u,this.fileNames[i]=r.firstChild&&r.firstChild.nodeValue?r.firstChild.nodeValue.trim():"",this.width[i]=parseInt(r.getAttribute("width")),this.height[i]=parseInt(r.getAttribute("height")))},this.getProperty=function(t,e){var n=this[e];n[t];return this[e][t]},this.getFilePath=function(t,s){var l;if(null==s)return e().resolveGlobalVars(this.paths[t]+this.fileNames[t]+"."+this.extensions[t]);var u=this.paddings[t]-s.toString().length;u&&(u=0);var c={};return c[i]=(s+1).toString(),-1!=this.paths[t].indexOf(o)?(l=this.paths[t]+this.prefixes[t]+n.substr(0,u)+this.suffixes[t]+"."+this.extensions[t],l=a.resolveVars(l,c,r)):l=this.paths[t]+this.prefixes[t]+n.substr(0,u)+(s+1).toString()+this.suffixes[t]+"."+this.extensions[t],e().resolveGlobalVars(l)}}function a(){}function l(){this.strings={},this.init=function(){var t=e().templateManager.getAsset("locale");return null==t?void console.log("WLLocale can't init, asset locale not found in the template"):void this.parse(t)},this.parse=function(t){for(var e=new window.DOMParser,n=e.parseFromString(t,"text/xml"),i=n.querySelectorAll("resources > string"),r=0;r<i.length;r++){var o=i[r];this.strings[o.getAttribute("name")]=o.firstChild.data}},this.getString=function(t){return this.strings[t]},this.resolveStrings=function(t){return a.resolveVars(t,this.strings,"#")}}a.resolveVars=function(t,e,n){for(var i=0;;){var r=t.indexOf(n,i);if(-1==r)break;var o=t.indexOf(n,r+1);if(-1==o)break;var s=t.substring(r+1,o);if(null!=e[s]){var a=e[s];t=t.substr(0,r)+a+t.substr(o+1),i=r}else i=o}return t=t.replace(/^~\//g,"publication/")},a.getTimeStamp=function(){function t(t){return(10>t?"0":"")+t}var e=new Date;return e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+t(e.getHours())+t(e.getMinutes())+t(e.getSeconds())},a.getRestrictRect=function(t,e){var n={},i=e.height/e.width,r=t.height/t.width;if(isNaN(r))return t;var o,s=t.width,a=t.height;return i>=r?(o=e.width/t.width,s=e.width,a*=o):(o=e.height/t.height,a=e.height,s*=o),n.width=s,n.height=a,n.x=(e.width-n.width)/2+e.x,n.y=(e.height-n.height)/2+e.y,n},a.getTodayDate=function(){var t=[];new Date;return t.push(TextHelpers.paddStr(modifiedDate.getDate(),"0",2)),t.push(TextHelpers.paddStr(modifiedDate.getMonth()+1,"0",2)),t.push(TextHelpers.paddStr(modifiedDate.getFullYear(),"0",4)),t.join("/")},a.load=function(t,e,n){void 0==t&&wpApp.trace("can't load an undefined url");var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(r){4==i.readyState&&(200==i.status?e.apply(n,[i.responseText]):wpApp.trace("Erreur pendant le chargement de "+t))},i.send(null)},window.wpApp=new t,wpApp.init()}()}();