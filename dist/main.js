/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/index.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("(function () {\r\n  WPViewer = function () {\r\n    /*\r\n    Main App class\r\n    starts the loading of the assets\r\n    instanciates and prepare the main components\r\n    */\r\n    \r\n    function App() {\r\n\r\n      var debug = true;\r\n      this.startFile;\r\n      this.simpleViewer;\r\n      this.viewers = [];\r\n      this.activeViewer;\r\n\r\n      this.init = function(){\r\n        ContextManager().init(onContextReady);\r\n      }    \r\n\r\n      this.getDomPath = function(el) {\r\n        var stack = [];\r\n        while ( el.parentNode != null ) {\r\n            var sibCount = 0;\r\n            var sibIndex = 0;\r\n            for ( var i = 0; i < el.parentNode.childNodes.length; i++ ) {\r\n                var sib = el.parentNode.childNodes[i];\r\n                if ( sib.nodeName == el.nodeName ) {\r\n                    if ( sib === el ) {\r\n                        sibIndex = sibCount;\r\n                    }\r\n                    sibCount++;\r\n                }\r\n            }\r\n            if ( el.hasAttribute('id') && el.id != '' ) {\r\n                stack.unshift(el.nodeName.toLowerCase() + el.id);\r\n            } else if ( sibCount > 1 ) {\r\n                stack.unshift(el.nodeName.toLowerCase() + sibIndex);\r\n            } else {\r\n                stack.unshift(el.nodeName.toLowerCase());\r\n            }\r\n            el = el.parentNode;\r\n        }\r\n        return stack.slice(1); // removes the html element\r\n      }  \r\n\r\n      //when all the common objects are ready and the assets are available\r\n      function continueInit() {\r\n        this.locale = new WLLocale();\r\n        this.locale.init();\r\n        this.simpleViewer = new SimpleViewer();\r\n        this.simpleViewer.init();\r\n      }\r\n\r\n      function onContextReady() {\r\n        continueInit();\r\n      }\r\n\r\n      //debug conditionnal logging\r\n      this.trace = function (_msg) {\r\n        if (debug) {\r\n          console.log(\"WPAPP - \" + _msg);\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    //handles the publication context data like content and template\r\n    function ContextManager() {\r\n\r\n      if (arguments.callee._singletonInstance) {\r\n        return arguments.callee._singletonInstance;\r\n      }\r\n      arguments.callee._singletonInstance = this;\r\n\r\n      this.contentManager;\r\n      this.templateManager;\r\n      var startUrl = \"publication/contents/pubinfo.xml\";\r\n      var startFile;\r\n      var contentUrl;\r\n      var templateUrl;\r\n      var contentsXml;\r\n      var templateXml;\r\n      var onContextReady;\r\n      this.globalVars = {};\r\n      this.ready = false;\r\n\r\n      this.init = function (_onContextReady) {\r\n        WLUtils.load(startUrl, onStartFileLoaded, this);\r\n        onContextReady = _onContextReady;\r\n      }\r\n\r\n      function continueInit() {        \r\n        resolveAllVars(this);\r\n        this.templateManager = new TemplateManager();\r\n        this.contentManager = new ContentManager();\r\n        this.contentManager.init(contentsXml, this.globalVars);\r\n        this.templateManager.init(templateXml,onAssetManagerReady);        \r\n      }\r\n\r\n      function checkAllReady() {\r\n        if (contentsXml && templateXml) {\r\n          continueInit();\r\n        }\r\n      }\r\n\r\n      function setRootPath() {\r\n        var rootPath = startUrl.substring(0,startUrl.lastIndexOf(\"/\")+1);\r\n        rootVarValue = globalVars.root;\r\n        if(rootVarValue == \"..\"){\r\n          rootPath = rootPath.substring(0,rootPath.substring(0,rootPath.length-2).lastIndexOf(\"/\")+1);\r\n        }\r\n        globalVars.root = rootPath;\r\n      }\r\n\r\n      function onStartFileLoaded(_startFile) {\r\n        startFile = new window.DOMParser().parseFromString(_startFile, \"text/xml\").firstChild;\r\n        readVars(startFile.querySelector(\"variables\"), this);\r\n        setRootPath();\r\n        contentUrl = startFile.querySelector(\"contents\").getAttribute(\"url\");\r\n        WLUtils.load(this.resolveGlobalVars(contentUrl), onContentsLoaded, this);\r\n        templateUrl = startFile.querySelector(\"template\").getAttribute(\"url\");\r\n        WLUtils.load(this.resolveGlobalVars(templateUrl), onTemplateLoaded, this);\r\n      }\r\n\r\n      function onContentsLoaded(_contentsFile) {\r\n        contentsXml = new window.DOMParser().parseFromString(_contentsFile, \"text/xml\").firstChild;\r\n        readVars(contentsXml.querySelector(\"variables\"), this);\r\n        checkAllReady();\r\n      }\r\n\r\n      function onTemplateLoaded(_templateFile) {\r\n        templateXml = new window.DOMParser().parseFromString(_templateFile, \"text/xml\").firstChild;\r\n        readVars(templateXml.querySelector(\"variables\"), this);\r\n        checkAllReady();\r\n      }\r\n\r\n      function onAssetManagerReady() {\r\n        this.ready = true;\r\n        onContextReady();\r\n      }\r\n\r\n      function resolveAllVars(_context) {\r\n        for (var i in _context.globalVars) {\r\n          _context.globalVars[i] = WLUtils.resolveVars(_context.globalVars[i], _context.globalVars, \"$\");\r\n        }\r\n      }\r\n      //adds all the children tags of _xml with the form <name value=\"value\"> into the object _context.globalVars\r\n      function readVars(_xml, _context) {\r\n        for (var i = 0; i < _xml.childNodes.length; i++) {\r\n          var node = _xml.childNodes[i];\r\n          if (node.nodeType != 1) {\r\n            continue;\r\n          }\r\n\r\n          _context.globalVars[node.nodeName] = WLUtils.resolveVars(node.getAttribute(\"value\"), _context.globalVars,\"$\");\r\n        }\r\n      }\r\n      this.resolveGlobalVars = function (_txt) {\r\n        return WLUtils.resolveVars(_txt, this.globalVars, \"$\")\r\n      }\r\n      return this;\r\n    }\r\n\r\n\r\n    function GenericPreloader(_contentId){\r\n\r\n      //protected var model:ViewerModel;//model class for the flipBook\r\n      var contentId = _contentId;\r\n      var preloader = this;\r\n\r\n      var backQueueLength = 2;//length of the preloading backward\r\n      var frontQueueLength = 2;//length of the preloading forward\r\n      var backFlushLength = 3;//length of the flushing backward\r\n      var frontFlushLength = 3;//length of the flushing forward\r\n\r\n      var loadingPages = [];\r\n      var preloadJob;//List of pages to preload (after isFull is called)\r\n      var nbLoading = 0;//number of pages still to load\r\n      var flushFileJob;//job describing all the flush to make in the Bitmap vector\r\n\r\n      var pageChangeTimeout;\r\n      var observers = [];//observers for pageLoading\r\n\r\n      this.labelFunction = 'onPageLoaded'; \r\n\r\n      var extension = ContextManager().contentManager.getProperty(contentId, \"extensions\");\r\n      var nbPages = ContextManager().contentManager.pagesNum;\r\n      //model.addEventListener(ViewerModel.PAGE_CHANGE, onPageChange);  \r\n      var itemsList = [];//list containing all the page files\r\n      var items = itemsList;\r\n      \r\n\r\n      this.onPageChange = function () {\r\n        clearTimeout(pageChangeTimeout);\r\n        pageChangeTimeout = setTimeout(checkQueue, 60,this);\r\n      }\r\n      \r\n      this.getPage = function (_pageIndex, _refObs) {\r\n        if (_pageIndex < 0 || _pageIndex > nbPages) {\r\n          return null;\r\n        }\r\n        if (itemsList[_pageIndex] == null) {\r\n          //checkQueue();\r\n          isFull();\r\n          //if i need the last image, but it's not in the queue, i need to mannualy add it\r\n          if (preloadJob.indexOf(_pageIndex) == -1) {\r\n            preloadJob.push(_pageIndex);\r\n          }\r\n          processFileQueue();\r\n          if (itemsList[_pageIndex])\r\n            return itemsList[_pageIndex];\r\n          \r\n          addPageObserver(_refObs, _pageIndex);\r\n          return null;\r\n        }\r\n\r\n        return itemsList[_pageIndex];\r\n      }\r\n      \r\n        /**\r\n         * Triggers the queue mechanism if needed\r\n         * is called whenever the queue should be checked (page change for example)\r\n         */\r\n      function checkQueue(preloader) {\r\n        if (!isFull())\r\n          processFileQueue();\r\n      }\r\n\r\n        /**\r\n         * Verifies if the cache is full and returns the answer\r\n         * Also fills 2 Arrays containing all the pages needed to be preloaded or draw into a bitmap\r\n         * @return\r\n         */\r\n      function isFull() {\r\n        \r\n        preloadJob = [];\r\n        flushFileJob = [];\r\n        var currentPage = wpApp.activeViewer.currentPage;\r\n\r\n        var firstPageFile = currentPage - backQueueLength > 0 ? currentPage - backQueueLength : 0;\r\n        var lastPageFile = currentPage + frontQueueLength <= nbPages-1 ? currentPage + frontQueueLength : nbPages-1;\r\n\r\n\r\n        var firstPageFileFlush = currentPage - backFlushLength > 0 ? currentPage - backFlushLength : 0;\r\n        var lastPageFileFlush = currentPage + frontFlushLength <= nbPages-1 ? currentPage + frontFlushLength : nbPages-1;\r\n\r\n        for (var i = 0; i <= nbPages; ++i) {\r\n\r\n          if (i >= firstPageFile && i <= lastPageFile) {\r\n            if (itemsList[i] == null) {\r\n              preloadJob.push(i);\r\n            }\r\n          }\r\n          if (itemsList[i] != null && (i < firstPageFileFlush || i > lastPageFileFlush)) {\r\n            flushFileJob.push(i);\r\n          }\r\n        }\r\n\r\n        return !(preloadJob.length > 0 || flushFileJob.length > 0);\r\n      }\r\n\r\n      /**\r\n       * after Queue has been declared not up to date, this function triggers the loading of the elements missing, listed in :\r\n       * preloadJob:Array\r\n       * and\r\n       * bitmapJob:Array\r\n       */\r\n      this.createImageLoader = function(_url, _handler,_errorHandler,_pageNum,_scope) {\r\n        var imgLoader = new Image();\r\n        \r\n        if(_scope == null){\r\n          _scope = preloader;\r\n        }\r\n        imgLoader.onload = function(){  \r\n          _handler.apply(_scope,[this,_pageNum]);\r\n        }\r\n        imgLoader.onerror = function(){\r\n          _errorHandler.apply(_scope,[this,_pageNum]);\r\n        }\r\n        imgLoader.src = _url;\r\n      }\r\n\r\n      function createTextLoader(_url, _handler,_errorHandler,_pageNum,_scope) {\r\n        if(_scope == null){\r\n          _scope = preloader;\r\n        }\r\n        var handler = function(_content){\r\n          _handler.apply(_scope,[_content,_pageNum]);\r\n        }\r\n        WLUtils.load(_url, handler, this);\r\n      }\r\n\r\n      /**\r\n       * launch preload on missing pages\r\n       */\r\n      function processFileQueue() {\r\n        for (var i = 0; i < preloadJob.length; ++i) {\r\n          var pageNum = preloadJob[i];\r\n          if (loadingPages[pageNum] == null) {\r\n            loadingPages[pageNum] = true;\r\n            var completePath = ContextManager().contentManager.getFilePath(contentId,pageNum);\r\n            /*if (_allowCacheBuster)\r\n            completePath += \"?CacheBusterID=\" + new Date().getTime();*/\r\n            if(extension == \"jpg\"){\r\n              preloader.createImageLoader(completePath, onComplete,errorHandler,pageNum,this);\r\n            }else if(extension == \"xml\"){\r\n              createTextLoader(completePath, onComplete,errorHandler,pageNum,this);\r\n            }\r\n            nbLoading++;\r\n          }\r\n        }        \r\n        emptyQueue();\r\n      }\r\n\r\n      /**\r\n       * Determines which file just arrived\r\n       * Stores reference in the pageFile Vector\r\n       * @param loader_\r\n       * CustomLoader event\r\n       */\r\n      function onComplete(_image,_pageNum) {\r\n        itemsList[_pageNum] = _image;\r\n        loadingPages[_pageNum] = null;\r\n        dispatchPageEvent(_pageNum);\r\n        nbLoading--;\r\n      }\r\n\r\n      function errorHandler(_image,_pageNum) {\r\n        loadingPages[_pageNum] = null;\r\n        if (observers[_pageNum] != null) {\r\n          var tmpObs = observers[_pageNum];\r\n\r\n          while (tmpObs.length > 0) {\r\n            var obj = tmpObs[0];\r\n            obj['onItemMissing'](items[_pageNum], _pageNum);\r\n            removePageObserver(obj, _pageNum);\r\n          }\r\n        }\r\n      }\r\n         \r\n      function emptyQueue() {\r\n        for (var i = 0; i < flushFileJob.length; ++i) {\r\n          var pageNum = flushFileJob[i];\r\n          itemsList[pageNum] = null;\r\n        }\r\n      }\r\n         \r\n      this.invalidate = function(_pageNum) {\r\n        itemsList[_pageNum] = null;\r\n        loadingPages[_pageNum] = null;\r\n      }\r\n      \r\n      this.clean = function() {\r\n        var nbPages = ContextManager().contentManager.pagesNum;\r\n        flushFileJob = [];        \r\n        for (var i = 0; i <= nbPages; ++i) {\r\n          flushFileJob.push(i);\r\n        }        \r\n        emptyQueue();\r\n      }\r\n      \r\n      /**\r\n       * Store the * instance reference for later call back\r\n       * @param    _refObs\r\n       * * instance reference\r\n       * @param    _pageIndex\r\n       * number of the page\r\n       */\r\n      function addPageObserver(_refObs, _pageIndex) {\r\n        removeObserver(_refObs);\r\n\r\n        \r\n        \r\n        if (observers[_pageIndex] == undefined){\r\n          observers[_pageIndex] = [];\r\n        }\r\n        if (observers[_pageIndex].indexOf(_refObs) != -1) {\r\n          return;\r\n        }\r\n        observers[_pageIndex].push(_refObs);\r\n      }\r\n         \r\n      /**\r\n       * remove observer for any pageNumber from the list\r\n       * @param    _refObs\r\n       */\r\n      function removeObserver(_refObs){\r\n        var index;\r\n\r\n        for (var obsListId in observers) {\r\n          var obsList = observers[obsListId];\r\n          index = obsList.indexOf(_refObs);\r\n\r\n          if (index != -1)\r\n            obsList.splice(index, 1);\r\n        }\r\n      }\r\n         \r\n      /**\r\n       * remove observer/pageNumber couple from the list\r\n       * @param    _refObs\r\n       */\r\n\r\n      function removePageObserver(_refObs, _pageNum) {\r\n        var pageObserverList = observers[_pageNum];\r\n        index = pageObserverList.indexOf(_refObs);\r\n        if (index != -1){\r\n          pageObserverList.splice(index, 1);\r\n        }\r\n      }\r\n         \r\n      /**\r\n       * dispatch page ready event to the * Observers\r\n       *\r\n       * @param    index_\r\n       * number of the page just ready\r\n       */\r\n      function dispatchPageEvent(_index) {        \r\n        if (items[_index] != null && observers[_index] != null) {\r\n          var tmpObs = observers[_index];\r\n          while (tmpObs.length > 0) {\r\n            var obj = tmpObs[0];\r\n            /*if(obj[preloader.labelFunction] == null){\r\n              console.log(\"error\");\r\n            }*/\r\n            obj[preloader.labelFunction](items[_index], _index);\r\n            removePageObserver(obj, _index);\r\n          }\r\n        }\r\n      }\r\n      \r\n      function hasObserver(_index) {\r\n        return items[_index] != null && observers[_index] != null;\r\n      }\r\n      \r\n      this.destroy = function() {\r\n        clearTimeout(pageChangeTimeout);\r\n        if (loadingPages)\r\n          loadingPages.length = 0;\r\n        if (preloadJob)\r\n          preloadJob.length = 0;\r\n        if (flushFileJob)\r\n          flushFileJob.length = 0;\r\n        if (itemsList)\r\n          itemsList.length = 0;\r\n        observers.length = 0;\r\n        observers = null;\r\n        items = null;\r\n      }\r\n\r\n    }\r\n\r\n    function SimpleViewer() {\r\n      SimpleViewer.prototype.id = \"simpleViewer\";\r\n      SimpleViewer.prototype.currentPage = 0;\r\n      var viewer = this;\r\n\r\n      var mainContainer;\r\n      var listeningTransitionEnd;\r\n      var linkContainer;\r\n      var initialMouseX;\r\n      var mouseMoved;\r\n      var dragging;\r\n      var imgTransition = \"\";\r\n      var nextImgPlaced;\r\n      var imgPlaced;\r\n      var lastTimestamp;\r\n      var initialMouseY;\r\n      var offsetX = 0;\r\n      var offsetY = 0;\r\n      var context;\r\n      var img;            \r\n      var marginRight = 10;\r\n      var marginBottom = 10;\r\n      var marginLeft = 10;\r\n      var marginTop = 10;\r\n      var screenWidth;\r\n      var screenHeight;\r\n      var transitionning = false;\r\n      var direction;\r\n      var nbPages = ContextManager().contentManager.pagesNum;\r\n      var nextImg;\r\n      var offsetTarget;\r\n      var transitionTime = 200;\r\n      var startTransitionTime;\r\n      var transitionInterval;\r\n      var zoomLoadingTimeout;\r\n      var links;\r\n      var linksDef = [];\r\n      var basePageWidth = parseFloat(ContextManager().contentManager.getProperty(\"swf\", \"width\"));\r\n      var basePageHeight = parseFloat(ContextManager().contentManager.getProperty(\"swf\", \"height\"));\r\n      var lastWidth;\r\n      var lastHeight;\r\n      var pagePosition;\r\n      var preloader;\r\n      var linkPreloader;\r\n      var minDragFrameDuration = 85;\r\n      var transitionDuration = 0.13;\r\n      var tmpDefaultPage = document.createElement(\"img\");\r\n      var defaultImageData = \"data:image/gif;base64,R0lGODlhAQABAPAAAP8AAP///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\";\r\n      tmpDefaultPage.setAttribute(\"src\",defaultImageData);\r\n      \r\n\r\n      function getDefaultPage (){\r\n        //return null;\r\n        console.log(\"getDefaultPage\")\r\n        var newDefaultPage = tmpDefaultPage.cloneNode();\r\n        newDefaultPage.width = basePageWidth;\r\n        newDefaultPage.height = basePageHeight; \r\n        newDefaultPage.setAttribute(\"data-default\",\"true\");\r\n        return newDefaultPage;\r\n      } \r\n\r\n      SimpleViewer.prototype.init = function () {\r\n\r\n        mainContainer = document.createElement(\"div\");\r\n        mainContainer = document.body.appendChild(mainContainer);\r\n        //removes \r\n        mainContainer.onselectstart = function(e){e.preventDefault();return false;}\r\n        mainContainer.onmousedown = function(event){\r\n          onMouseDown(event);\r\n        }\r\n        mainContainer.addEventListener(\"touchstart\",function(event){\r\n          onMouseDown(event);\r\n        });\r\n        mainContainer.setAttribute(\"class\",\"simpleViewer\");\r\n\r\n        linkContainer = document.createElement(\"div\");        \r\n        \r\n        linkContainer.setAttribute(\"class\",\"absolute\");\r\n        mainContainer.appendChild(linkContainer);\r\n        \r\n        wpApp.viewers.push[this];\r\n        wpApp.activeViewer = this;\r\n\r\n        preloader = new GenericPreloader(\"Low\");\r\n        linkPreloader = new GenericPreloader(\"links\");\r\n        linkPreloader.labelFunction = \"onLinkLoaded\";\r\n\r\n        screenWidth = window.innerWidth;\r\n        screenHeight = window.innerHeight;\r\n\r\n        getPagePosition();\r\n\r\n        var tmpPage = preloader.getPage(0,viewer);\r\n        if(tmpPage == null){\r\n          tmpPage = getDefaultPage();\r\n        }\r\n        if(tmpPage != null){\r\n          this.onPageLoaded(tmpPage,0);\r\n        }\r\n        window.onresize = function(){\r\n          viewer.onResize();\r\n        }\r\n        \r\n      }\r\n\r\n      function getScreenRect(){\r\n        return {x:marginLeft,y:marginTop,width:screenWidth - marginLeft - marginRight,height:screenHeight - marginTop - marginBottom}\r\n      }\r\n\r\n      SimpleViewer.prototype.onResize = function(){\r\n        screenWidth = window.innerWidth;\r\n        screenHeight = window.innerHeight;\r\n        getPagePosition();\r\n        drawPage();\r\n        placeLinkContainer();\r\n      }\r\n\r\n      SimpleViewer.prototype.onPageLoaded = function(_image,_pageNum){\r\n        if(transitionning){\r\n          return;\r\n        }\r\n        \r\n        console.log(\"onPageLoaded begin\");\r\n        var imgs = document.querySelectorAll(\"img\");\r\n        if(imgs.length > 1){\r\n          console.log(\"problem onPageLoaded\");\r\n        }\r\n        removeImg();\r\n        img = _image;\r\n        imgPlaced = false;\r\n        if(pagePosition == null){\r\n          getPagePosition();\r\n        }\r\n        \r\n        drawPage();\r\n        linkPreloader.getPage(viewer.currentPage,viewer);\r\n        clearTimeout(zoomLoadingTimeout);\r\n        zoomLoadingTimeout = setTimeout(onEndTransition,500,viewer);\r\n\r\n        console.log(\"onPageLoaded end\");\r\n      }\r\n\r\n      SimpleViewer.prototype.onLinkLoaded = function(_links,_pageNum){\r\n        if(_pageNum != this.currentPage){\r\n          return;\r\n        }\r\n        links = _links;\r\n        drawLinks();\r\n      }\r\n\r\n      function getPagePosition(){\r\n        if(img == null && lastWidth == null){\r\n          return;\r\n        }\r\n        lastWidth = img != null ? img.width  : lastWidth;\r\n        lastHeight = img != null ? img.height  : lastHeight;\r\n        var newRect = WLUtils.getRestrictRect({x:0,y:0,width:lastWidth,height:lastHeight},getScreenRect());\r\n        newRect.marginXNext = screenWidth - newRect.x;\r\n        newRect.scale = newRect.width/basePageWidth;\r\n        pagePosition = newRect;\r\n      }\r\n\r\n      function drawLinks(){\r\n        links = new window.DOMParser().parseFromString(links, \"text/xml\");\r\n        links = links.querySelectorAll(\"lk\");\r\n        placeLinkContainer();\r\n        for(var i = 0;i<links.length;i++){\r\n          var link = links[i];\r\n          var content = link.querySelector(\"content\");\r\n          var def = {};\r\n          def.x = parseFloat(content.getAttribute(\"x\"));\r\n          def.y = parseFloat(content.getAttribute(\"y\"));\r\n          def.width = parseFloat(content.getAttribute(\"width\"));\r\n          def.height = parseFloat(content.getAttribute(\"height\"));\r\n          def.contentFile = content.querySelector(\"file\");\r\n          if(def.contentFile){\r\n            def.contentFile = ContextManager().resolveGlobalVars(def.contentFile.getAttribute(\"url\"));\r\n          }else{\r\n            continue;\r\n          }\r\n          var handler = function(_content){\r\n            onAnimLinkLoaded.apply(viewer,[_content,link,def]);\r\n          }\r\n          WLUtils.load(def.contentFile, handler, this);\r\n        }\r\n      }\r\n\r\n      function loadLinks(){\r\n        deleteLinks();\r\n        var linksTmp = linkPreloader.getPage(viewer.currentPage,viewer);\r\n        if(linksTmp != null){\r\n          viewer.onLinkLoaded(linksTmp,viewer.currentPage);\r\n        }\r\n      }\r\n\r\n      function deleteLinks(){        \r\n        for(var i = 0;i<linksDef.length;i++){\r\n          var linkDef = linksDef[i];\r\n          linkContainer.removeChild(linkDef.element);\r\n          linkDef.animClass.destroy();\r\n        }\r\n        linksDef.length = 0;\r\n      }\r\n\r\n      function placeLinkContainer(){\r\n        linkContainer.setAttribute(\"style\",imgTransition+\"transform: translate(\"+(pagePosition.x+offsetX)+\"px, \"+(pagePosition.y+offsetY)+\"px) scale3d(\"+pagePosition.scale+\",\"+pagePosition.scale+\",\"+pagePosition.scale+\")\");\r\n      }\r\n\r\n      function onAnimLinkLoaded(_animHTML,_link,_linkDef){\r\n        anim = new window.DOMParser().parseFromString(_animHTML, \"text/html\");\r\n        style = anim.body.querySelector(\"style\");\r\n        bodyChildren = anim.querySelectorAll(\"body > div\");\r\n        script = anim.querySelector(\"script\");\r\n        var animElement = document.createElement(\"div\");\r\n        animElement.setAttribute(\"id\",\"wpanim\");\r\n        animElement = linkContainer.appendChild(animElement);\r\n        animElement.setAttribute(\"style\",\"position: absolute;transform: translate(\"+_linkDef.x+\"px, \"+_linkDef.y+\"px)\");\r\n        _linkDef.element = animElement;\r\n        linksDef.push(_linkDef);\r\n        animElement.appendChild(style);\r\n        for(var i=0;i<bodyChildren.length;i++){\r\n          var bodyChild = bodyChildren[i];\r\n          var img = bodyChild.querySelector(\"img\");\r\n          var url = img.getAttribute(\"src\").replace(\"assets/\",_linkDef.contentFile+\"assets/\");\r\n          img.setAttribute(\"src\",url);\r\n          animElement.appendChild(bodyChild);\r\n        }\r\n        url = script.getAttribute(\"src\").replace(\"assets/\",_linkDef.contentFile+\"assets/\");\r\n        var newScript = document.createElement( 'script' );\r\n        newScript.type = 'text/javascript';        \r\n        newScript.src = url;\r\n        newScript = animElement.appendChild(newScript);\r\n        newScript.onload = function(event){\r\n          onAnimScriptLoaded(event,newScript,_linkDef);\r\n        };\r\n        \r\n      }\r\n\r\n      function onAnimScriptLoaded(event,_newScript,_linkDef){\r\n        _linkDef.animClass = WPAnimsClasses[wpApp.getDomPath(_newScript).join(\"\")];\r\n      }\r\n\r\n      function placePages(){\r\n        if(img == null){return;}\r\n        \r\n        var scale = pagePosition.width / img.width;\r\n        var transition = imgPlaced?imgTransition:\"transition:none;\";\r\n        if(nextImg && transitionning){\r\n          var imgX = direction == -1?pagePosition.x+offsetX:pagePosition.x+offsetX;\r\n          img.setAttribute(\"style\",transition+\"transform:translate(\"+imgX+\"px,\"+pagePosition.y+\"px) scale(\"+scale+\",\"+scale+\")\");\r\n          imgPlaced = true;\r\n          \r\n          //var imageWidth = nextImg.width != null : nextImg.width : 10;\r\n          //log(\"taille \"+nextImg.width);\r\n          scale = pagePosition.width / nextImg.width;\r\n          imgX = direction == 1?pagePosition.marginXNext+pagePosition.x+offsetX:pagePosition.x+offsetX-pagePosition.marginXNext;\r\n          transition = nextImgPlaced?imgTransition:\"transition:none;\";\r\n          nextImg.setAttribute(\"style\",transition+\"transform:translate(\"+imgX+\"px,\"+pagePosition.y+\"px) scale(\"+scale+\",\"+scale+\")\");\r\n          nextImgPlaced = true;          \r\n        }else{\r\n          //log(imgPlaced);\r\n          //log(imgTransition);\r\n          //log(transition);\r\n          img.setAttribute(\"style\",transition+\"transform:translate(\"+pagePosition.x+\"px,\"+pagePosition.y+\"px) scale(\"+scale+\",\"+scale+\")\");\r\n          imgPlaced = true;\r\n          if(listeningTransitionEnd){\r\n            endTransition();\r\n          }\r\n        }\r\n        \r\n      }\r\n\r\n      function removeNextImg(){\r\n        console.log(\"removeNextImg\");\r\n        if(nextImg && nextImg.parentElement){\r\n          nextImg.parentElement.removeChild(nextImg);\r\n        }\r\n      }\r\n\r\n      function removeImg(){\r\n        console.log(\"removeImg\");\r\n        if(img && img.parentElement){\r\n          img.parentElement.removeChild(img);\r\n        }\r\n      }\r\n\r\n      function addImg(){\r\n        \r\n        if(img != null && img.parentElement != mainContainer){\r\n          console.log(\"addImg\");\r\n          img.setAttribute(\"class\",\"absolute notInteractive\");\r\n          img = mainContainer.insertBefore(img,linkContainer);\r\n        }\r\n        var imgs = document.querySelectorAll(\"img\");\r\n        if(imgs.length > 1){\r\n          console.log(\"problem\");\r\n        }\r\n      }\r\n\r\n      function addNextImg(){\r\n        if(nextImg != null && nextImg.parentElement != mainContainer){\r\n          console.log(\"addNextImg\");\r\n          nextImg = mainContainer.insertBefore(nextImg,linkContainer);\r\n          nextImg.setAttribute(\"class\",\"absolute notInteractive\");\r\n        }\r\n        var imgs = document.querySelectorAll(\"img\");\r\n        if(imgs.length > 2){\r\n          console.log(\"problem\");\r\n        }\r\n      }\r\n\r\n      function drawPage(){\r\n        addImg();\r\n        addNextImg();\r\n        placePages();\r\n      }\r\n\r\n      function isValidPage(_pageNum){\r\n        return _pageNum>=0 && _pageNum<nbPages;\r\n      }\r\n\r\n      function getNextPage(){\r\n        var tmp = viewer.currentPage;\r\n        if(++tmp >= nbPages-1){\r\n          tmp = nbPages-1;\r\n        }\r\n        return tmp;\r\n      }\r\n\r\n      function getPrevPage(){\r\n        var tmp = viewer.currentPage;\r\n        if(--tmp < 0){\r\n          tmp = 0;\r\n        }\r\n        return tmp;\r\n      }\r\n\r\n      function onMouseDown(event){\r\n\r\n        if(event.touches){\r\n          event = event.touches[0];\r\n        }\r\n        if(transitionning){\r\n          return;\r\n        }\r\n        //log(\"\");\r\n        //log(\"onMouseDown\");\r\n        initialMouseX = event.clientX;\r\n        initialMouseY = event.clientY;\r\n        offsetX = 0;\r\n        offsetY = 0;\r\n\r\n        mainContainer.addEventListener(\"touchmove\",onMouseMove);\r\n        mainContainer.onmousemove = function(event){\r\n          onMouseMove(event);\r\n        }\r\n        mainContainer.addEventListener(\"touchend\",onMouseUp);\r\n        mainContainer.onmouseup = function(event){\r\n          onMouseUp(event);\r\n        }\r\n        dragging = true;\r\n        window.requestAnimationFrame(dragFrameAnim);\r\n        \r\n      }\r\n\r\n      function onMouseUp(event){\r\n        //log(\"onMouseUp\");\r\n        mainContainer.onmousemove = null;\r\n        mainContainer.removeEventListener(\"touchmove\",onMouseMove);\r\n        mainContainer.onmouseup = null;\r\n        mainContainer.removeEventListener(\"touchend\",onMouseUp);\r\n        dragging = false;\r\n        imgTransition = \"transition:none;\";\r\n        if(transitionning){\r\n          stopTransition();\r\n        }\r\n      }\r\n\r\n      function onMouseMove(event){\r\n        if(event.touches){\r\n          event = event.touches[0];\r\n        }\r\n        offsetX = event.clientX - initialMouseX;\r\n        mouseMoved = true;\r\n      }\r\n\r\n      function dragFrameAnim(_timestamp){\r\n        if(mouseMoved && (lastTimestamp == null || _timestamp - lastTimestamp >= minDragFrameDuration)){\r\n          if(!transitionning){\r\n            if(offsetX<0){\r\n              startDrag(1);\r\n            }else if(offsetX>0){\r\n              startDrag(-1);\r\n            }\r\n          }\r\n          imgTransition = \"transition: transform \"+transitionDuration+\"s linear;\";\r\n          lastTimestamp = _timestamp;\r\n          placeLinkContainer();\r\n          //log(\"dragFrameAnim\");\r\n          placePages();\r\n          mouseMoved = false;\r\n        }\r\n        if(dragging){\r\n          window.requestAnimationFrame(dragFrameAnim);\r\n        }\r\n      }\r\n\r\n      function startDrag(_direction){\r\n\r\n        if(!isValidPage(viewer.currentPage+_direction)){\r\n          offsetX = 0;\r\n          mainContainer.onmousemove = null;\r\n          //log(\"startDrag\");\r\n          placePages();\r\n          return;\r\n        }\r\n        var imgs = document.querySelectorAll(\"img\");\r\n        if(imgs.length > 1){\r\n          console.log(\"problem\");\r\n        }\r\n        console.log(\"startDrag\");\r\n        if(zoomLoadingTimeout){\r\n          clearTimeout(zoomLoadingTimeout);\r\n          zoomLoadingTimeout = null;\r\n        }\r\n        imgPlaced = false;\r\n        direction = _direction;\r\n        transitionning = true;\r\n        var tmpNextImg = preloader.getPage(direction == 1?getNextPage():getPrevPage(),viewer);\r\n        nextImgPlaced = false;\r\n        if(tmpNextImg == null){\r\n          tmpNextImg = getDefaultPage();\r\n        }\r\n        removeNextImg();\r\n        nextImg = tmpNextImg;\r\n        drawPage();\r\n      }\r\n\r\n      function stopTransition(){\r\n        //log(\"stopTransition\");\r\n        lastTimestamp = null;\r\n        offsetTarget = (-screenWidth + pagePosition.x)*direction;\r\n        startXOffset = offsetX;\r\n        offsetX = offsetTarget;\r\n        imgTransition = \"transition: transform \"+0.25+\"s ease-in;\";\r\n        mouseMoved = false;\r\n        if(img != null){\r\n          imgPlaced = true;\r\n          img.addEventListener(\"transitionend\",onPageTransitionEnd,false);\r\n          listeningTransitionEnd = true;\r\n          placePages();\r\n          placeLinkContainer();\r\n        }else{\r\n          endTransition();\r\n        }\r\n      }\r\n\r\n      function onPageTransitionEnd(event){\r\n        console.log(\"onPageTransitionEnd\");\r\n        img.removeEventListener(\"transitionend\",onPageTransitionEnd);\r\n        endTransition();\r\n      }\r\n\r\n      function endTransition(){\r\n        //log(\"endTransition\");\r\n        listeningTransitionEnd = false;\r\n        removeImg();\r\n        if(direction == 1){\r\n          viewer.currentPage = getNextPage();\r\n        }else{\r\n          viewer.currentPage = getPrevPage();\r\n        }\r\n        console.log(nextImg.getAttribute(\"data-default\"));\r\n        if(nextImg != null && nextImg.getAttribute(\"data-default\") == \"true\"){\r\n          \r\n          var tmpImage = preloader.getPage(viewer.currentPage,viewer);\r\n          if(tmpImage){\r\n            removeNextImg();\r\n            img = tmpImage;\r\n          }\r\n        }else{\r\n          img = nextImg;\r\n        }\r\n        var imgs = document.querySelectorAll(\"img\");\r\n        if(imgs.length > 1){\r\n          console.log(\"problem\");\r\n        }\r\n        imgPlaced = false;\r\n        nextImg = null;\r\n        \r\n        offsetX = 0;\r\n        transitionning = false;\r\n        startTransitionTime = null;\r\n        preloader.onPageChange();\r\n        linkPreloader.onPageChange();\r\n        drawPage();\r\n        zoomLoadingTimeout = setTimeout(onEndTransition,500,viewer);\r\n        loadLinks();\r\n      }\r\n\r\n      function setTransitionFrame(_timestamp){\r\n        if (!startTransitionTime) startTransitionTime = _timestamp;\r\n        elapsed = _timestamp - startTransitionTime;\r\n        var finished = elapsed>=transitionTime;\r\n        if(finished){\r\n          elapsed = transitionTime;\r\n          endTransition();\r\n        }else{\r\n          offsetX = easeOutQuad(elapsed,startXOffset,offsetTarget - startXOffset,transitionTime);\r\n          //log(\"setTransitionFrame\");\r\n          placePages();\r\n        }\r\n        \r\n        placeLinkContainer();\r\n        if(!finished){\r\n          window.requestAnimationFrame(setTransitionFrame);\r\n        }\r\n      }\r\n\r\n      function onEndTransition(viewer){\r\n        var completePath = ContextManager().contentManager.getFilePath(\"Zoom\",viewer.currentPage);\r\n        preloader.createImageLoader(completePath, onZoomPageLoaded,onZoomPageError,viewer.currentPage,viewer);\r\n      }\r\n\r\n      function onZoomPageLoaded(_image,_pageNum){\r\n        if(_pageNum == viewer.currentPage && !transitionning){\r\n          removeImg();\r\n          img = _image;\r\n          imgPlaced = false;\r\n          console.log(\"onZoomPageLoaded\");\r\n          drawPage();\r\n        }\r\n      }\r\n\r\n      function onZoomPageError(_image,_pageNum){\r\n        wpApp.trace(\"onZoomPageError\")\r\n      }\r\n      \r\n      function easeOutQuad(t, b, c, d) {\r\n        return -c *(t/=d)*(t-2) + b;\r\n      }\r\n    }\r\n\r\n    //handles the preloading of the template assets at the start of the application : locale, config, interface, css, ...\r\n    //and provide their contents\r\n    //if integrated in main source it should load template.xml\r\n    function TemplateManager() {\r\n      var xml;\r\n      var assetsNode;\r\n      var assets = {};\r\n      var assetsPreloading = 0;\r\n      var onAssetPreloaded;\r\n      //filters out these assets, when switching for the class in the mail visio JS cources, you can reactivate the loading of the base assets\r\n      var idFilterOut = [\"main_lib\",\"interface\", \"css\", \"css_flash\", \"css_html5\", \"description_css\",\"font\", \"shop_lib\"];\r\n      var idFilterIn = [\"interface\",\"locale\",\"config\",\"locale_cart\", \"tpl\", \"tpl2\"];\r\n\r\n      this.init = function (_xml, _onAssetsPreloaded) {\r\n        xml = _xml;\r\n        onAssetPreloaded = _onAssetsPreloaded;\r\n        assetsNode = xml.querySelector(\"assets\");\r\n\r\n        for (var i = 0; i < assetsNode.childNodes.length; i++) {\r\n\r\n          var assetNode = assetsNode.childNodes[i];\r\n          if (assetNode.nodeType != 1) {\r\n            continue;\r\n          }\r\n          var assetId = assetNode.getAttribute(\"id\");\r\n          //filters in or out, in have priority, to use out, undeclare idFilterIn\r\n          if ((idFilterIn && idFilterIn.indexOf(assetId) == -1) || (!idFilterIn && idFilterOut && idFilterOut.indexOf(assetId) != -1)) {\r\n            continue;\r\n          }\r\n          var onStart = assetNode.getAttribute(\"onstart\");\r\n          if (onStart == undefined || onStart == \"true\") {\r\n            loadAsset(assetNode.getAttribute(\"type\"), assetId, assetNode.getAttribute(\"url\"));\r\n          }\r\n        }\r\n      }\r\n\r\n      function loadAsset(_type, _id, _url) {\r\n        assetsPreloading++;\r\n        assets[_id] = new AssetLoader(_type, _id, ContextManager().resolveGlobalVars(_url), ContextManager().templateManager.onAssetLoaded);\r\n      }\r\n      this.onAssetLoaded = function (_asset, _content) {\r\n        assetsPreloading--;\r\n        if (assetsPreloading == 0) {\r\n          if (onAssetPreloaded) {\r\n            onAssetPreloaded();\r\n          }\r\n        }\r\n      }\r\n      this.getAsset = function (_id) {\r\n        if (!assets[_id]) {\r\n          console.log(\"Asset not declared : \" + _id);\r\n          return null;\r\n        }\r\n        return assets[_id].content;\r\n      }\r\n    }\r\n\r\n    function AssetLoader(_type, _id, _url, _callBack) {\r\n      var type = _type;\r\n      var id = _id;\r\n      var url = _url;\r\n      var callBack = _callBack;\r\n      this.content;\r\n      AssetLoader.prototype.onLoaded = function (_content) {\r\n        this.content = _content;\r\n        callBack(this, this.content);\r\n      }\r\n\r\n      WLUtils.load(_url, this.onLoaded, this);\r\n    }\r\n\r\n    //ContextManager.contentManager\r\n    //handles the content description to provide the urls\r\n    function ContentManager() {\r\n      /**\r\n       *  xml taken from tag --> config.xml -> root -> contents\r\n       */\r\n      var xml;\r\n      var padding_chars = \"0000000000000000\";\r\n      var NUM_VAR_NAME = \"num\";\r\n      var NUM_VAR_DELIMITER = \"%\";\r\n      var NUM_VAR = NUM_VAR_DELIMITER + NUM_VAR_NAME + NUM_VAR_DELIMITER;\r\n      /**\r\n       * Contains paths for all content-types\r\n       * incl. prefixes\r\n       */\r\n      this.paths = {};\r\n      this.prefixes = {};\r\n      this.suffixes = {};\r\n      this.paddings = {};\r\n      this.extensions = {};\r\n      this.fileNames = {};\r\n      this.width = {};\r\n      this.height = {};\r\n      /**\r\n       * Contains suffixes for all content-types\r\n       */\r\n      var suffix = '';\r\n      var prefix = '';\r\n      /**\r\n       * Contains paddings for all content-types\r\n       */\r\n      var padding = 0\r\n\r\n      /**\r\n       * [shift] se adauga la indexul paginii pentru a obtine un nume corect de pagina\r\n       * URLHelpers.getFilePath(index, ..) -> index += shift\r\n       */\r\n      var shift = 0;\r\n\r\n      this.pagesNum;\r\n\r\n      this.init = function (_xml, _hash) {\r\n        xml = _xml.querySelector(\"contents\");\r\n\r\n        prefix = xml.getAttribute('prefix') ? xml.getAttribute('prefix') : '';\r\n        suffix = xml.getAttribute('sufix') ? xml.getAttribute('suffix') : '';\r\n        padding = xml.getAttribute('padding') ? parseInt(xml.getAttribute('padding')) : 0;\r\n        shift = xml.getAttribute('shift') ? parseInt(xml.getAttribute('shift')) : 0;\r\n        this.pagesNum = xml.getAttribute('pages_nr') ? parseInt(xml.getAttribute('pages_nr')) : 0;\r\n\r\n        var contentId;\r\n        var content;\r\n        for (var i = 0; i < xml.childNodes.length; i++) {\r\n          content = xml.childNodes[i];\r\n          if (content.nodeType != 1) {\r\n            continue;\r\n          }\r\n\r\n          contentId = content.getAttribute(\"id\");\r\n\r\n          //create the global var hash\r\n\r\n          this.paths[contentId] = WLUtils.resolveVars(content.getAttribute(\"path\", _hash, \"$\"));\r\n          this.extensions[contentId] = content.getAttribute('type') ? content.getAttribute('type') : '';\r\n          this.prefixes[contentId] = content.getAttribute('prefix') ? content.getAttribute('prefix') : prefix;\r\n          this.suffixes[contentId] = content.getAttribute('suffix') ? content.getAttribute('suffix') : suffix;\r\n          this.paddings[contentId] = content.getAttribute('padding') ? parseInt(content.getAttribute('padding')) :padding;\r\n          this.fileNames[contentId] = content.firstChild && content.firstChild.nodeValue ? content.firstChild.nodeValue.trim() : '';\r\n          this.width[contentId] =  parseInt(content.getAttribute('width'));\r\n          this.height[contentId] = parseInt(content.getAttribute('height'));\r\n        }\r\n      }\r\n\r\n      this.getProperty = function(_contentId,_propName){\r\n        var prop = this[_propName];\r\n        var value = prop[_contentId]\r\n        return this[_propName][_contentId];\r\n      }\r\n\r\n      /**\r\n       * Filename example: page0001big.swf\r\n       * prefix - page\r\n       * padding - 000 = 3 -> nr minim de caractere\r\n       * index - 1, this value comes as parameter\r\n       * sufix - big\r\n       *\r\n       * ext - swf, png, jpg, jpeg, etc.\r\n       *\r\n       *\r\n       * Usage example\r\n       * trace(URLHelpers.getFilePath('1', 'swf')) // contents/pages/page1.swf\r\n\r\n       * @param index_ file index in queue wich is same as\r\n       * @param contentId_ content tag id, example swf for flipBook and thumbnail for ThumbnailLoader\r\n       *\r\n       * @return complete path to the file, web or local path\r\n       */\r\n      this.getFilePath = function (content_id_, index_) {\r\n        var path;\r\n        if (index_ == null) {\r\n          return ContextManager().resolveGlobalVars(this.paths[content_id_] + this.fileNames[content_id_] + '.' + this.extensions[content_id_]);\r\n        }\r\n\r\n        var delta = this.paddings[content_id_] - index_.toString().length;\r\n        if (delta) {\r\n          delta = 0;\r\n        }\r\n        // end to do\r\n\r\n        // content/page\r\n        // we check for the %num%\r\n        var varHash = {};\r\n        varHash[NUM_VAR_NAME] = (index_ + 1).toString();\r\n        if (this.paths[content_id_].indexOf(NUM_VAR) != -1) {\r\n          path = (this.paths[content_id_] + this.prefixes[content_id_] + padding_chars.substr(0, delta) + this.suffixes[\r\n            content_id_] + '.' + this.extensions[content_id_]);\r\n          path = WLUtils.resolveVars(path, varHash, NUM_VAR_DELIMITER);\r\n        } else {\r\n          path = (this.paths[content_id_] + this.prefixes[content_id_] + padding_chars.substr(0, delta) + (index_ + 1).toString() +\r\n            this.suffixes[content_id_] + '.' + this.extensions[content_id_]);\r\n        }\r\n\r\n        return ContextManager().resolveGlobalVars(path);\r\n      }\r\n\r\n    }\r\n\r\n    //just a container for some useful functions\r\n    function WLUtils() {}\r\n    //replaces any instance of a variable found in the \"_src\" string, take their value in the _hash object,\r\n    //variable instances must start and end with the character defined in _separateChr\r\n    WLUtils.resolveVars = function (_src, _hash, _separateChr) {\r\n      var origsrc = _src;\r\n      var currentIndex = 0;\r\n      while (true) {\r\n        var startIndex = _src.indexOf(_separateChr, currentIndex);\r\n        if (startIndex == -1) {\r\n          break;\r\n        }\r\n        var endIndex = _src.indexOf(_separateChr, startIndex + 1);\r\n        if (endIndex == -1) {\r\n          break;\r\n        }\r\n        var hashId = _src.substring(startIndex + 1, endIndex);\r\n        if (_hash[hashId] != null) {\r\n          var hashcontent = _hash[hashId];\r\n          _src = _src.substr(0, startIndex) + hashcontent + _src.substr(endIndex + 1);\r\n          currentIndex = startIndex;\r\n        } else {\r\n          currentIndex = endIndex;\r\n        }\r\n      }\r\n      _src = _src.replace(/^~\\//g, 'publication/');\r\n      return _src;\r\n    }\r\n\r\n    WLUtils.getTimeStamp = function () {\r\n      var date = new Date();\r\n\r\n      function pad2(n) {\r\n        return (n < 10 ? '0' : '') + n;\r\n      }\r\n\r\n      return date.getFullYear() +\r\n        pad2(date.getMonth() + 1) +\r\n        pad2(date.getDate()) +\r\n        pad2(date.getHours()) +\r\n        pad2(date.getMinutes()) +\r\n        pad2(date.getSeconds());\r\n    }\r\n\r\n    WLUtils.getRestrictRect = function(_objRect, _refRect) {\r\n\r\n        var newArea = {};\r\n        var ratioTally = _refRect.height / _refRect.width;\r\n\r\n        //get ref h/w ratio\r\n        var ratioRef = _objRect.height / _objRect.width;\r\n        if (isNaN(ratioRef)){\r\n          return _objRect;\r\n        }\r\n        var new_x = _objRect.width;\r\n        var new_y = _objRect.height;\r\n\r\n        var factor;\r\n        //choose from height or width\r\n        if (ratioRef <= ratioTally) {\r\n            factor = _refRect.width / _objRect.width;\r\n            new_x = _refRect.width;\r\n            new_y *= factor;\r\n        } else {\r\n            factor = _refRect.height / _objRect.height;\r\n            new_y = _refRect.height;\r\n            new_x *= factor;\r\n        }\r\n        //set width and height\r\n        newArea.width = new_x;\r\n        newArea.height = new_y;\r\n        newArea.x = (_refRect.width - newArea.width) / 2 + _refRect.x;      \r\n        newArea.y = (_refRect.height - newArea.height) / 2 + _refRect.y;\r\n        \r\n        return newArea;\r\n    }\r\n\r\n    WLUtils.getTodayDate = function () {\r\n      var propsDate = [];\r\n      var date = new Date();\r\n      propsDate.push(TextHelpers.paddStr(modifiedDate.getDate(), \"0\", 2));\r\n      propsDate.push(TextHelpers.paddStr(modifiedDate.getMonth() + 1, \"0\", 2));\r\n      propsDate.push(TextHelpers.paddStr(modifiedDate.getFullYear(), \"0\", 4));\r\n      return propsDate.join(\"/\");\r\n    }\r\n\r\n    //loads a text file async, callback keeps the class scope\r\n    WLUtils.load = function (_url, _callBack, _observer) {\r\n      if (_url == undefined) {\r\n        wpApp.trace(\"can't load an undefined url\");\r\n      }\r\n      var req = new XMLHttpRequest();\r\n      req.open('GET', _url, true);\r\n      //req.callBack = _callBack;\r\n      req.onreadystatechange = function (aEvt) {\r\n        if (req.readyState == 4) {\r\n          if (req.status == 200)\r\n            _callBack.apply(_observer, [req.responseText]);\r\n          else\r\n            wpApp.trace(\"Erreur pendant le chargement de \" + _url);\r\n        }\r\n      };\r\n      req.send(null);\r\n    }\r\n\r\n    //this model loads and stores localization data\r\n    function WLLocale() {\r\n\r\n      this.strings = {};\r\n\r\n      this.init = function () {\r\n        var assetContent = ContextManager().templateManager.getAsset(\"locale\");\r\n        if (assetContent == null) {\r\n          console.log(\"WLLocale can't init, asset locale not found in the template\")\r\n          return;\r\n        }\r\n        this.parse(assetContent);\r\n      }\r\n\r\n      this.parse = function (_xml) {\r\n\r\n        var parser = new window.DOMParser();\r\n        var xml = parser.parseFromString(_xml, \"text/xml\");\r\n        var stringsList = xml.querySelectorAll(\"resources > string\");\r\n        for (var i = 0; i < stringsList.length; i++) {\r\n          var string = stringsList[i];\r\n          this.strings[string.getAttribute(\"name\")] = string.firstChild.data;\r\n        }\r\n      }\r\n\r\n      this.getString = function (_id) {\r\n        return this.strings[_id];\r\n      }\r\n\r\n      this.resolveStrings = function (_src) {\r\n        return WLUtils.resolveVars(_src, this.strings, \"#\")\r\n      }\r\n    }    \r\n\r\n    window.wpApp = new App();\r\n    wpApp.init();\r\n\r\n  }();\r\n\r\n})();\r\n\n\n//# sourceURL=webpack:///./src/index.js?");

/***/ })

/******/ });